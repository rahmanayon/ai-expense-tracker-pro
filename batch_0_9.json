[
    {
        "index": 0,
        "content": "graph TD\n    A[Web Client: React 18 + Next.js 14] --> B[API Gateway: Node.js + Express]\n    C[Android App: Kotlin + Jetpack Compose] --> B\n    D[OCR Service: Python Tesseract] --> B\n    E[AI Engine: Python FastAPI] --> B\n    B --> F[Backend: Node.js + Express]\n    F --> G[Database: PostgreSQL 15]\n    F --> H[Cache: Redis]\n    F --> I[Message Queue: RabbitMQ]\n    G --> J[Backup: AWS S3]"
    },
    {
        "index": 1,
        "content": "-- Users table\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email VARCHAR(255) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    full_name VARCHAR(255),\n    preferred_currency VARCHAR(3) DEFAULT 'USD',\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Categories table\nCREATE TABLE categories (\n    id SERIAL PRIMARY KEY,\n    name VARCHAR(100) NOT NULL,\n    emoji VARCHAR(10),\n    type VARCHAR(10) CHECK (type IN ('expense', 'income')),\n    user_id UUID REFERENCES users(id),\n    is_default BOOLEAN DEFAULT FALSE,\n    UNIQUE(name, user_id)\n);\n\nINSERT INTO categories (name, emoji, type, is_default) VALUES\n('Groceries', 'ðŸ›’', 'expense', TRUE),\n('Utility Bills', 'ðŸ’¡', 'expense', TRUE),\n('Salary', 'ðŸ’¼', 'income', TRUE),\n('Personal Spending', 'ðŸ‘¤', 'expense', TRUE),\n('Clothing', 'ðŸ‘”', 'expense', TRUE),\n('Lifestyle Activities', 'ðŸŽ¯', 'expense', TRUE),\n('Dining Out', 'ðŸ½ï¸', 'expense', TRUE),\n('Entertainment', 'ðŸŽ¬', 'expense', TRUE),\n('Transportation', 'ðŸš—', 'expense', TRUE),\n('Healthcare', 'ðŸ¥', 'expense', TRUE),\n('Education', 'ðŸ“š', 'expense', TRUE),\n('Other', 'ðŸ“¦', 'expense', TRUE);\n\n-- Transactions table\nCREATE TABLE transactions (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    category_id INTEGER REFERENCES categories(id),\n    type VARCHAR(10) CHECK (type IN ('expense', 'income')),\n    amount DECIMAL(12,2) NOT NULL,\n    description TEXT,\n    transaction_date DATE NOT NULL,\n    receipt_image_url VARCHAR(500),\n    is_ocr_processed BOOLEAN DEFAULT FALSE,\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Budgets table\nCREATE TABLE budgets (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    category_id INTEGER REFERENCES categories(id),\n    monthly_amount DECIMAL(12,2) NOT NULL,\n    year INTEGER NOT NULL,\n    month INTEGER NOT NULL CHECK (month BETWEEN 1 AND 12),\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW(),\n    UNIQUE(user_id, category_id, year, month)\n);\n\n-- Investments table\nCREATE TABLE investments (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    name VARCHAR(255) NOT NULL,\n    type VARCHAR(100) NOT NULL,\n    principal DECIMAL(12,2) NOT NULL,\n    purchase_date DATE,\n    current_value DECIMAL(12,2),\n    expected_return DECIMAL(5,2),\n    notes TEXT,\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- AI Insights table\nCREATE TABLE ai_insights (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    insight_type VARCHAR(50) NOT NULL,\n    title VARCHAR(255) NOT NULL,\n    description TEXT NOT NULL,\n    category_filter VARCHAR(100),\n    date_range_start DATE,\n    date_range_end DATE,\n    is_actionable BOOLEAN DEFAULT TRUE,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Indexes for performance\nCREATE INDEX idx_transactions_user_date ON transactions(user_id, transaction_date DESC);\nCREATE INDEX idx_transactions_category ON transactions(category_id);\nCREATE INDEX idx_budgets_user_year_month ON budgets(user_id, year, month);\nCREATE INDEX idx_investments_user_type ON investments(user_id, type);\n\n-- Updated_at trigger\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = NOW();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();\nCREATE TRIGGER update_transactions_updated_at BEFORE UPDATE ON transactions FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();\nCREATE TRIGGER update_budgets_updated_at BEFORE UPDATE ON budgets FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();\nCREATE TRIGGER update_investments_updated_at BEFORE UPDATE ON investments FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();"
    },
    {
        "index": 2,
        "content": "backend/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ config/          # Database, auth, etc.\nâ”‚   â”œâ”€â”€ controllers/     # Route handlers\nâ”‚   â”œâ”€â”€ middleware/      # Auth, validation, etc.\nâ”‚   â”œâ”€â”€ models/          # Sequelize models\nâ”‚   â”œâ”€â”€ routes/          # API routes\nâ”‚   â”œâ”€â”€ services/        # Business logic\nâ”‚   â”œâ”€â”€ utils/           # Helpers\nâ”‚   â””â”€â”€ app.js           # Express app\nâ”œâ”€â”€ tests/\nâ”‚   â””â”€â”€ unit/\nâ”œâ”€â”€ package.json\nâ””â”€â”€ Dockerfile"
    },
    {
        "index": 3,
        "content": "// src/app.js\nconst express = require('express');\nconst cors = require('cors');\nconst helmet = require('helmet');\nconst compression = require('compression');\nconst rateLimit = require('express-rate-limit');\nrequire('dotenv').config();\n\nconst app = express();\n\n// Security middleware\napp.use(helmet());\napp.use(cors({\n    origin: process.env.FRONTEND_URL,\n    credentials: true\n}));\napp.use(compression());\n\n// Rate limiting\nconst limiter = rateLimit({\n    windowMs: 15 * 60 * 1000, // 15 minutes\n    max: 100 // limit each IP to 100 requests per windowMs\n});\napp.use('/api/', limiter);\n\n// Body parsing\napp.use(express.json({ limit: '10mb' }));\napp.use(express.urlencoded({ extended: true }));\n\n// Routes\napp.use('/api/auth', require('./routes/auth'));\napp.use('/api/transactions', require('./routes/transactions'));\napp.use('/api/budgets', require('./routes/budgets'));\napp.use('/api/investments', require('./routes/investments'));\napp.use('/api/dashboard', require('./routes/dashboard'));\napp.use('/api/ocr', require('./routes/ocr'));\napp.use('/api/voice', require('./routes/voice'));\n\n// Error handling\napp.use((err, req, res, next) => {\n    console.error(err.stack);\n    res.status(err.status || 500).json({\n        error: process.env.NODE_ENV === 'development' ? err.message : 'Internal Server Error'\n    });\n});\n\nmodule.exports = app;"
    },
    {
        "index": 4,
        "content": "// src/controllers/transactionController.js\nconst { Transaction, Category } = require('../models');\nconst { Op } = require('sequelize');\nconst { calculateAIInsights } = require('../services/aiService');\n\nexports.createTransaction = async (req, res, next) => {\n    try {\n        const { categoryId, type, amount, description, transactionDate, receiptImageUrl } = req.body;\n        const userId = req.user.id;\n\n        // Validate category belongs to user\n        const category = await Category.findOne({ where: { id: categoryId, user_id: userId } });\n        if (!category) {\n            return res.status(400).json({ error: 'Invalid category' });\n        }\n\n        const transaction = await Transaction.create({\n            user_id: userId,\n            category_id: categoryId,\n            type,\n            amount,\n            description,\n            transaction_date: transactionDate,\n            receipt_image_url: receiptImageUrl\n        });\n\n        // Trigger AI insight recalculation\n        calculateAIInsights(userId).catch(console.error);\n\n        res.status(201).json({ success: true, data: transaction });\n    } catch (error) {\n        next(error);\n    }\n};\n\nexports.getTransactions = async (req, res, next) => {\n    try {\n        const userId = req.user.id;\n        const { startDate, endDate, categoryId, type } = req.query;\n\n        const whereClause = { user_id: userId };\n        if (startDate && endDate) {\n            whereClause.transaction_date = { [Op.between]: [startDate, endDate] };\n        }\n        if (categoryId) {\n            whereClause.category_id = categoryId;\n        }\n        if (type) {\n            whereClause.type = type;\n        }\n\n        const transactions = await Transaction.findAll({\n            where: whereClause,\n            include: [{ model: Category, attributes: ['name', 'emoji'] }],\n            order: [['transaction_date', 'DESC']],\n            limit: 1000\n        });\n\n        res.json({ success: true, data: transactions });\n    } catch (error) {\n        next(error);\n    }\n};"
    },
    {
        "index": 5,
        "content": "frontend/\nâ”œâ”€â”€ app/\nâ”‚   â”œâ”€â”€ dashboard/\nâ”‚   â”‚   â”œâ”€â”€ page.js\nâ”‚   â”‚   â””â”€â”€ DashboardFilters.js\nâ”‚   â”œâ”€â”€ transactions/\nâ”‚   â”‚   â””â”€â”€ page.js\nâ”‚   â”œâ”€â”€ investments/\nâ”‚   â”‚   â””â”€â”€ page.js\nâ”‚   â”œâ”€â”€ settings/\nâ”‚   â”‚   â””â”€â”€ page.js\nâ”‚   â””â”€â”€ layout.js\nâ”œâ”€â”€ components/\nâ”‚   â”œâ”€â”€ Dashboard/\nâ”‚   â”‚   â”œâ”€â”€ AIInsightsPanel.js\nâ”‚   â”‚   â”œâ”€â”€ BudgetChart.js\nâ”‚   â”‚   â”œâ”€â”€ ExpenseChart.js\nâ”‚   â”‚   â””â”€â”€ IncomeExpenseTrend.js\nâ”‚   â”œâ”€â”€ Transactions/\nâ”‚   â”‚   â”œâ”€â”€ TransactionForm.js\nâ”‚   â”‚   â”œâ”€â”€ TransactionList.js\nâ”‚   â”‚   â”œâ”€â”€ OCRUpload.js\nâ”‚   â”‚   â””â”€â”€ VoiceInput.js\nâ”‚   â””â”€â”€ UI/\nâ”‚       â”œâ”€â”€ Header.js\nâ”‚       â”œâ”€â”€ Sidebar.js\nâ”‚       â””â”€â”€ LoadingSpinner.js\nâ”œâ”€â”€ lib/\nâ”‚   â”œâ”€â”€ api.js\nâ”‚   â””â”€â”€ auth.js\nâ”œâ”€â”€ hooks/\nâ”‚   â””â”€â”€ useTransactions.js\nâ”œâ”€â”€ styles/\nâ””â”€â”€ package.json"
    },
    {
        "index": 6,
        "content": "// components/Dashboard/DashboardFilters.js\n'use client';\nimport { useState, useEffect } from 'react';\nimport { DateRangePicker } from 'react-date-range';\nimport 'react-date-range/dist/styles.css';\nimport 'react-date-range/dist/theme/default.css';\n\nexport default function DashboardFilters({ onFilterChange }) {\n    const [dateRange, setDateRange] = useState([\n        {\n            startDate: new Date(new Date().setDate(new Date().getDate() - 30)),\n            endDate: new Date(),\n            key: 'selection'\n        }\n    ]);\n    const [selectedCategories, setSelectedCategories] = useState([]);\n    const [categories, setCategories] = useState([]);\n\n    useEffect(() => {\n        fetchCategories();\n    }, []);\n\n    const fetchCategories = async () => {\n        const res = await fetch('/api/categories');\n        const data = await res.json();\n        setCategories(data);\n    };\n\n    const handleApplyFilters = () => {\n        onFilterChange({\n            startDate: dateRange[0].startDate.toISOString().split('T')[0],\n            endDate: dateRange[0].endDate.toISOString().split('T')[0],\n            categories: selectedCategories\n        });\n    };\n\n    return (\n        <div className=\"bg-white p-6 rounded-lg shadow-md mb-6\">\n            <h3 className=\"text-lg font-semibold mb-4\">Advanced Filters</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div>\n                    <label className=\"block text-sm font-medium mb-2\">Date Range</label>\n                    <DateRangePicker\n                        ranges={dateRange}\n                        onChange={item => setDateRange([item.selection])}\n                    />\n                </div>\n                <div>\n                    <label className=\"block text-sm font-medium mb-2\">Categories</label>\n                    <select \n                        multiple\n                        value={selectedCategories}\n                        onChange={(e) => setSelectedCategories([...e.target.selectedOptions].map(o => o.value))}\n                        className=\"w-full h-32 border rounded-md p-2\"\n                    >\n                        {categories.map(cat => (\n                            <option key={cat.id} value={cat.id}>\n                                {cat.emoji} {cat.name}\n                            </option>\n                        ))}\n                    </select>\n                </div>\n                <div className=\"flex items-end\">\n                    <button \n                        onClick={handleApplyFilters}\n                        className=\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700\"\n                    >\n                        Apply Filters\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}"
    },
    {
        "index": 7,
        "content": "// components/Transactions/OCRUpload.js\n'use client';\nimport { useState } from 'react';\nimport { useDropzone } from 'react-dropzone';\n\nexport default function OCRUpload({ onDataExtracted }) {\n    const [isProcessing, setIsProcessing] = useState(false);\n    const [preview, setPreview] = useState(null);\n\n    const { getRootProps, getInputProps } = useDropzone({\n        accept: { 'image/*': ['.png', '.jpg', '.jpeg'] },\n        maxSize: 200 * 1024 * 1024, // 200MB limit\n        onDrop: async (acceptedFiles) => {\n            const file = acceptedFiles[0];\n            setPreview(URL.createObjectURL(file));\n            setIsProcessing(true);\n\n            const formData = new FormData();\n            formData.append('image', file);\n\n            try {\n                const res = await fetch('/api/ocr/extract', {\n                    method: 'POST',\n                    body: formData\n                });\n                const data = await res.json();\n                onDataExtracted(data); // Send extracted data to parent\n            } catch (error) {\n                console.error('OCR Error:', error);\n            } finally {\n                setIsProcessing(false);\n            }\n        }\n    });\n\n    return (\n        <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center\">\n            <div {...getRootProps()} className=\"cursor-pointer\">\n                <input {...getInputProps()} />\n                <p className=\"text-lg mb-2\">ðŸ“¸ Scan Invoice</p>\n                <p className=\"text-sm text-gray-600\">\n                    Drag & drop or <span className=\"text-blue-600\">browse files</span>\n                </p>\n                <p className=\"text-xs text-gray-500 mt-2\">PNG, JPG up to 200MB</p>\n            </div>\n            {preview && (\n                <div className=\"mt-4\">\n                    <img src={preview} alt=\"Receipt preview\" className=\"max-h-48 mx-auto rounded\" />\n                </div>\n            )}\n            {isProcessing && (\n                <div className=\"mt-4\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n                    <p className=\"text-sm mt-2\">Processing...</p>\n                </div>\n            )}\n        </div>\n    );\n}"
    },
    {
        "index": 8,
        "content": "android/\nâ”œâ”€â”€ app/\nâ”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”œâ”€â”€ main/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ java/com/expensetracker/\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MainActivity.kt\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ui/\nâ”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/\nâ”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ transactions/\nâ”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ components/\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ data/\nâ”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api/\nâ”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ repository/\nâ”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ models/\nâ”‚   â”‚   â”‚   â”‚   â””â”€â”€ utils/\nâ”‚   â”‚   â”‚   â””â”€â”€ res/\nâ”‚   â”‚   â””â”€â”€ test/\nâ”‚   â””â”€â”€ build.gradle"
    },
    {
        "index": 9,
        "content": "// app/src/main/java/com/expensetracker/ui/dashboard/DashboardScreen.kt\n@Composable\nfun DashboardScreen(\n    viewModel: DashboardViewModel = viewModel(),\n    navController: NavController\n) {\n    val uiState by viewModel.uiState.collectAsState()\n    \n    Scaffold(\n        topBar = { ExpenseTrackerTopBar(title = \"Dashboard\") },\n        floatingActionButton = {\n            FloatingActionButton(onClick = { navController.navigate(\"add_transaction\") }) {\n                Icon(Icons.Default.Add, contentDescription = \"Add Transaction\")\n            }\n        }\n    ) { padding ->\n        Column(\n            modifier = Modifier\n                .fillMaxSize()\n                .padding(padding)\n                .verticalScroll(rememberScrollState())\n        ) {\n            // Filters\n            DashboardFilters(\n                dateRange = uiState.dateRange,\n                onDateRangeChange = { viewModel.updateDateRange(it) },\n                selectedCategories = uiState.selectedCategories,\n                onCategorySelection = { viewModel.toggleCategory(it) }\n            )\n            \n            // Summary Cards\n            SummaryCards(\n                income = uiState.totalIncome,\n                expenses = uiState.totalExpenses,\n                savings = uiState.savings,\n                currency = uiState.currency\n            )\n            \n            // Charts\n            ExpenseByCategoryChart(categories = uiState.expenseByCategory)\n            IncomeExpenseTrendChart(trendData = uiState.trendData)\n            BudgetComparisonChart(budgetData = uiState.budgetComparison)\n            \n            // AI Insights\n            AIInsightsPanel(insights = uiState.aiInsights)\n            \n            // Investment Overview\n            InvestmentSummary(investments = uiState.investmentSummary)\n        }\n    }\n}\n\n@Composable\nfun DashboardFilters(\n    dateRange: DateRange,\n    onDateRangeChange: (DateRange) -> Unit,\n    selectedCategories: List<String>,\n    onCategorySelection: (String) -> Unit\n) {\n    Card(\n        modifier = Modifier\n            .fillMaxWidth()\n            .padding(16.dp)\n    ) {\n        Column(modifier = Modifier.padding(16.dp)) {\n            Text(\n                text = \"Advanced Filters\",\n                style = MaterialTheme.typography.titleMedium\n            )\n            \n            Spacer(modifier = Modifier.height(8.dp))\n            \n            // Date Range Picker\n            DateRangeSelector(\n                startDate = dateRange.start,\n                endDate = dateRange.end,\n                onStartDateChange = { /* TODO */ },\n                onEndDateChange = { /* TODO */ }\n            )\n            \n            Spacer(modifier = Modifier.height(8.dp))\n            \n            // Category Multi-select\n            FlowRow(\n                modifier = Modifier.fillMaxWidth(),\n                mainAxisSpacing = 8.dp,\n                crossAxisSpacing = 8.dp\n            ) {\n                // Category chips would go here\n            }\n        }\n    }\n}"
    }
]