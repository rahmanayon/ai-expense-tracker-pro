[
    {
        "index": 30,
        "content": "<!-- mobile-demo.html -->\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Mobile Views - AI Expense Tracker Pro</title>\n    <style>\n        /* Mobile-specific styles */\n        .mobile-frame {\n            width: 375px;\n            height: 812px;\n            border: 10px solid #000;\n            border-radius: 30px;\n            margin: 20px auto;\n            overflow: hidden;\n            position: relative;\n            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n        }\n        \n        .mobile-screen {\n            width: 100%;\n            height: 100%;\n            overflow-y: auto;\n            background: var(--light);\n        }\n        \n        .mobile-header {\n            background: white;\n            padding: var(--space-md);\n            box-shadow: var(--shadow-sm);\n            position: sticky;\n            top: 0;\n            z-index: 100;\n        }\n        \n        .mobile-nav {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .mobile-menu-btn {\n            font-size: 1.5rem;\n            background: none;\n            border: none;\n            cursor: pointer;\n        }\n        \n        .mobile-fab {\n            position: fixed;\n            bottom: 20px;\n            right: 20px;\n            width: 56px;\n            height: 56px;\n            border-radius: 50%;\n            background: var(--primary);\n            color: white;\n            border: none;\n            font-size: 1.5rem;\n            box-shadow: var(--shadow-lg);\n            cursor: pointer;\n            z-index: 100;\n        }\n        \n        .transaction-item-mobile {\n            background: white;\n            padding: var(--space-md);\n            margin-bottom: var(--space-xs);\n            border-bottom: 1px solid var(--border);\n        }\n        \n        .bottom-nav {\n            position: fixed;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            background: white;\n            border-top: 1px solid var(--border);\n            display: flex;\n            justify-content: space-around;\n            padding: var(--space-sm) 0;\n        }\n        \n        .bottom-nav-item {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: var(--space-xs);\n            font-size: 0.75rem;\n            color: var(--text-secondary);\n            cursor: pointer;\n            padding: var(--space-xs);\n            border-radius: var(--radius-md);\n        }\n        \n        .bottom-nav-item.active {\n            color: var(--primary);\n            background: rgba(99, 102, 241, 0.1);\n        }\n        \n        .bottom-nav-item .icon {\n            font-size: 1.25rem;\n        }\n    </style>\n</head>\n<body>\n    <h1 style=\"text-align: center; margin: 2rem 0;\">Mobile Dashboard View</h1>\n    \n    <div class=\"mobile-frame\">\n        <div class=\"mobile-screen\">\n            <!-- Mobile Header -->\n            <div class=\"mobile-header\">\n                <div class=\"mobile-nav\">\n                    <button class=\"mobile-menu-btn\">‚ò∞</button>\n                    <div style=\"font-weight: 700;\">AI Finance Pro</div>\n                    <button class=\"mobile-menu-btn\">üë§</button>\n                </div>\n            </div>\n\n            <!-- Mobile Content -->\n            <div style=\"padding: var(--space-md);\">\n                <!-- Summary Cards (Stacked) -->\n                <div style=\"margin-bottom: var(--space-lg);\">\n                    <div class=\"summary-card income\" style=\"margin-bottom: var(--space-md);\">\n                        <h4>Income</h4>\n                        <div class=\"amount\">$0.00</div>\n                    </div>\n                    <div class=\"summary-card expenses\" style=\"margin-bottom: var(--space-md);\">\n                        <h4>Expenses</h4>\n                        <div class=\"amount\">$13,050</div>\n                    </div>\n                </div>\n\n                <!-- AI Insights (Collapsed) -->\n                <div class=\"card\" style=\"margin-bottom: var(--space-lg);\">\n                    <h3 style=\"font-size: 1rem; margin-bottom: var(--space-md);\">ü§ñ AI Insights</h3>\n                    <div style=\"font-size: 0.875rem; background: #fee2e2; color: #dc2626; padding: var(--space-sm); border-radius: var(--radius-md);\">\n                        ‚ö†Ô∏è Critical spending alert: $13k on groceries\n                    </div>\n                </div>\n\n                <!-- Quick Actions -->\n                <div class=\"card\" style=\"margin-bottom: var(--space-lg);\">\n                    <h3 style=\"font-size: 1rem; margin-bottom: var(--space-md);\">Quick Actions</h3>\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md);\">\n                        <button class=\"btn btn-primary\" style=\"font-size: 0.875rem; padding: var(--space-sm);\">+ Add Expense</button>\n                        <button class=\"btn btn-outline\" style=\"font-size: 0.875rem; padding: var(--space-sm);\">üì∏ Scan</button>\n                    </div>\n                </div>\n\n                <!-- Recent Transactions -->\n                <div>\n                    <h3 style=\"font-size: 1rem; margin-bottom: var(--space-md);\">Recent Transactions</h3>\n                    <div class=\"transaction-item-mobile\">\n                        <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                            <div>\n                                <div style=\"font-weight: 500;\">üõí Groceries</div>\n                                <div style=\"font-size: 0.75rem; color: var(--text-secondary);\">Jan 12</div>\n                            </div>\n                            <div style=\"color: var(--danger); font-weight: 600;\">-$13,050</div>\n                        </div>\n                    </div>\n                    <div class=\"transaction-item-mobile\">\n                        <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                            <div>\n                                <div style=\"font-weight: 500;\">üì∏ Groceries (OCR)</div>\n                                <div style=\"font-size: 0.75rem; color: var(--text-secondary);\">Jan 12</div>\n                            </div>\n                            <div style=\"color: var(--danger); font-weight: 600;\">-$0.01</div>\n                        </div>\n                    </div>\n                </div>\n\n                <div style=\"height: 80px;\"></div> <!-- Bottom nav spacer -->\n            </div>\n\n            <!-- Floating Action Button -->\n            <button class=\"mobile-fab\">+</button>\n\n            <!-- Bottom Navigation -->\n            <div class=\"bottom-nav\">\n                <div class=\"bottom-nav-item active\">\n                    <div class=\"icon\">üìä</div>\n                    <span>Dashboard</span>\n                </div>\n                <div class=\"bottom-nav-item\">\n                    <div class=\"icon\">üí≥</div>\n                    <span>Transactions</span>\n                </div>\n                <div class=\"bottom-nav-item\">\n                    <div class=\"icon\">üéØ</div>\n                    <span>Budgets</span>\n                </div>\n                <div class=\"bottom-nav-item\">\n                    <div class=\"icon\">üìà</div>\n                    <span>Investments</span>\n                </div>\n                <div class=\"bottom-nav-item\">\n                    <div class=\"icon\">‚öôÔ∏è</div>\n                    <span>Settings</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Bottom navigation interaction\n        document.querySelectorAll('.bottom-nav-item').forEach(item => {\n            item.addEventListener('click', function() {\n                document.querySelectorAll('.bottom-nav-item').forEach(i => i.classList.remove('active'));\n                this.classList.add('active');\n            });\n        });\n\n        // FAB action\n        document.querySelector('.mobile-fab').addEventListener('click', function() {\n            alert('Quick add transaction');\n        });\n\n        // Menu toggle simulation\n        document.querySelectorAll('.mobile-menu-btn').forEach(btn => {\n            btn.addEventListener('click', function() {\n                alert('Menu action');\n            });\n        });\n    </script>\n</body>\n</html>"
    },
    {
        "index": 31,
        "content": "ai-expense-tracker-pro/\n‚îú‚îÄ‚îÄ backend/                 # Node.js + Express API\n‚îú‚îÄ‚îÄ frontend/               # React + Next.js\n‚îú‚îÄ‚îÄ mobile/                 # React Native\n‚îú‚îÄ‚îÄ database/               # PostgreSQL + migrations\n‚îú‚îÄ‚îÄ ai-engine/              # Python FastAPI for OCR/AI\n‚îú‚îÄ‚îÄ tests/                  # Comprehensive test suites\n‚îú‚îÄ‚îÄ infrastructure/         # Docker + Kubernetes\n‚îú‚îÄ‚îÄ docs/                   # API documentation\n‚îî‚îÄ‚îÄ scripts/               # Deployment scripts"
    },
    {
        "index": 32,
        "content": "// backend/package.json\n{\n  \"name\": \"expense-tracker-backend\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Production-ready backend for AI Expense Tracker Pro\",\n  \"main\": \"src/index.js\",\n  \"scripts\": {\n    \"start\": \"node src/index.js\",\n    \"dev\": \"nodemon src/index.js\",\n    \"test\": \"jest --coverage\",\n    \"test:watch\": \"jest --watch\",\n    \"test:integration\": \"jest --testPathPattern=integration\",\n    \"migrate\": \"knex migrate:latest\",\n    \"seed\": \"knex seed:run\",\n    \"lint\": \"eslint src/**/*.js\",\n    \"lint:fix\": \"eslint src/**/*.js --fix\"\n  },\n  \"dependencies\": {\n    \"express\": \"^4.18.2\",\n    \"cors\": \"^2.8.5\",\n    \"helmet\": \"^7.0.0\",\n    \"bcrypt\": \"^5.1.0\",\n    \"jsonwebtoken\": \"^9.0.0\",\n    \"pg\": \"^8.11.0\",\n    \"knex\": \"^2.4.2\",\n    \"joi\": \"^17.9.2\",\n    \"winston\": \"^3.9.0\",\n    \"express-rate-limit\": \"^6.7.1\",\n    \"express-validator\": \"^7.0.1\",\n    \"multer\": \"^1.4.5-lts.1\",\n    \"sharp\": \"^0.32.1\",\n    \"redis\": \"^4.6.7\",\n    \"ioredis\": \"^5.3.2\",\n    \"node-cron\": \"^3.0.2\",\n    \"nodemailer\": \"^6.9.3\",\n    \"socket.io\": \"^4.7.1\",\n    \"stripe\": \"^12.9.0\",\n    \"dotenv\": \"^16.1.4\"\n  },\n  \"devDependencies\": {\n    \"jest\": \"^29.5.0\",\n    \"supertest\": \"^6.3.3\",\n    \"nodemon\": \"^2.0.22\",\n    \"eslint\": \"^8.42.0\",\n    \"eslint-config-airbnb-base\": \"^15.0.0\",\n    \"eslint-plugin-import\": \"^2.27.5\"\n  }\n}"
    },
    {
        "index": 33,
        "content": "// backend/src/config/server.js\nconst express = require('express');\nconst cors = require('cors');\nconst helmet = require('helmet');\nconst rateLimit = require('express-rate-limit');\nconst compression = require('compression');\nconst winston = require('winston');\n\n// Configure Winston logger\nconst logger = winston.createLogger({\n  level: 'info',\n  format: winston.format.combine(\n    winston.format.timestamp(),\n    winston.format.errors({ stack: true }),\n    winston.format.json()\n  ),\n  transports: [\n    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),\n    new winston.transports.File({ filename: 'logs/combined.log' }),\n    new winston.transports.Console({\n      format: winston.format.combine(\n        winston.format.colorize(),\n        winston.format.simple()\n      )\n    })\n  ]\n});\n\n// Security middleware\nconst securityMiddleware = (app) => {\n  app.use(helmet({\n    contentSecurityPolicy: {\n      directives: {\n        defaultSrc: [\"'self'\"],\n        styleSrc: [\"'self'\", \"'unsafe-inline'\", \"https://fonts.googleapis.com\"],\n        fontSrc: [\"'self'\", \"https://fonts.gstatic.com\"],\n        imgSrc: [\"'self'\", \"data:\", \"https:\"],\n        scriptSrc: [\"'self'\"],\n        connectSrc: [\"'self'\", process.env.FRONTEND_URL]\n      }\n    }\n  }));\n\n  app.use(cors({\n    origin: process.env.FRONTEND_URL,\n    credentials: true,\n    optionsSuccessStatus: 200\n  }));\n\n  // Rate limiting\n  const limiter = rateLimit({\n    windowMs: 15 * 60 * 1000, // 15 minutes\n    max: 100, // limit each IP to 100 requests per windowMs\n    message: 'Too many requests from this IP, please try again later.',\n    standardHeaders: true,\n    legacyHeaders: false,\n  });\n\n  app.use('/api/', limiter);\n\n  // Stricter rate limiting for auth endpoints\n  const authLimiter = rateLimit({\n    windowMs: 15 * 60 * 1000,\n    max: 5,\n    message: 'Too many authentication attempts, please try again later.',\n    skipSuccessfulRequests: true\n  });\n\n  app.use('/api/auth/login', authLimiter);\n  app.use('/api/auth/register', authLimiter);\n};\n\n// Production error handler\nconst errorHandler = (err, req, res, next) => {\n  logger.error(err.stack);\n\n  if (err.name === 'ValidationError') {\n    return res.status(400).json({\n      success: false,\n      error: 'Validation Error',\n      details: err.details\n    });\n  }\n\n  if (err.name === 'UnauthorizedError') {\n    return res.status(401).json({\n      success: false,\n      error: 'Unauthorized'\n    });\n  }\n\n  // Don't leak error details in production\n  res.status(500).json({\n    success: false,\n    error: process.env.NODE_ENV === 'production' \n      ? 'Internal Server Error' \n      : err.message\n  });\n};\n\nmodule.exports = { securityMiddleware, errorHandler, logger };"
    },
    {
        "index": 34,
        "content": "// backend/src/models/User.js\nconst { DataTypes } = require('sequelize');\nconst bcrypt = require('bcrypt');\nconst jwt = require('jsonwebtoken');\n\nmodule.exports = (sequelize) => {\n  const User = sequelize.define('User', {\n    id: {\n      type: DataTypes.UUID,\n      defaultValue: DataTypes.UUIDV4,\n      primaryKey: true\n    },\n    email: {\n      type: DataTypes.STRING,\n      allowNull: false,\n      unique: true,\n      validate: {\n        isEmail: true\n      }\n    },\n    password: {\n      type: DataTypes.STRING,\n      allowNull: false,\n      validate: {\n        len: [8, 100]\n      }\n    },\n    firstName: {\n      type: DataTypes.STRING,\n      allowNull: false,\n      validate: {\n        len: [2, 50]\n      }\n    },\n    lastName: {\n      type: DataTypes.STRING,\n      allowNull: false,\n      validate: {\n        len: [2, 50]\n      }\n    },\n    preferredCurrency: {\n      type: DataTypes.STRING,\n      defaultValue: 'USD'\n    },\n    isEmailVerified: {\n      type: DataTypes.BOOLEAN,\n      defaultValue: false\n    },\n    lastLoginAt: {\n      type: DataTypes.DATE\n    },\n    isActive: {\n      type: DataTypes.BOOLEAN,\n      defaultValue: true\n    },\n    twoFactorSecret: {\n      type: DataTypes.STRING\n    },\n    twoFactorEnabled: {\n      type: DataTypes.BOOLEAN,\n      defaultValue: false\n    },\n    subscriptionPlan: {\n      type: DataTypes.ENUM('free', 'premium', 'enterprise'),\n      defaultValue: 'free'\n    },\n    subscriptionEndsAt: {\n      type: DataTypes.DATE\n    },\n    resetPasswordToken: {\n      type: DataTypes.STRING\n    },\n    resetPasswordExpires: {\n      type: DataTypes.DATE\n    }\n  }, {\n    hooks: {\n      beforeSave: async (user) => {\n        if (user.changed('password')) {\n          const salt = await bcrypt.genSalt(12);\n          user.password = await bcrypt.hash(user.password, salt);\n        }\n      }\n    },\n    indexes: [\n      {\n        unique: true,\n        fields: ['email']\n      },\n      {\n        fields: ['isActive']\n      }\n    ]\n  });\n\n  User.prototype.validatePassword = async function(password) {\n    return bcrypt.compare(password, this.password);\n  };\n\n  User.prototype.generateAuthToken = function() {\n    return jwt.sign(\n      { \n        id: this.id, \n        email: this.email,\n        plan: this.subscriptionPlan \n      },\n      process.env.JWT_SECRET,\n      { expiresIn: process.env.JWT_EXPIRES_IN || '7d' }\n    );\n  };\n\n  User.prototype.generateRefreshToken = function() {\n    return jwt.sign(\n      { id: this.id },\n      process.env.JWT_REFRESH_SECRET,\n      { expiresIn: process.env.JWT_REFRESH_EXPIRES_IN || '30d' }\n    );\n  };\n\n  User.prototype.toJSON = function() {\n    const values = Object.assign({}, this.get());\n    delete values.password;\n    delete values.twoFactorSecret;\n    delete values.resetPasswordToken;\n    delete values.resetPasswordExpires;\n    return values;\n  };\n\n  return User;\n};"
    },
    {
        "index": 35,
        "content": "// backend/src/models/Transaction.js\nconst { DataTypes } = require('sequelize');\n\nmodule.exports = (sequelize) => {\n  const Transaction = sequelize.define('Transaction', {\n    id: {\n      type: DataTypes.UUID,\n      defaultValue: DataTypes.UUIDV4,\n      primaryKey: true\n    },\n    userId: {\n      type: DataTypes.UUID,\n      allowNull: false,\n      references: {\n        model: 'Users',\n        key: 'id'\n      }\n    },\n    categoryId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'Categories',\n        key: 'id'\n      }\n    },\n    type: {\n      type: DataTypes.ENUM('income', 'expense'),\n      allowNull: false\n    },\n    amount: {\n      type: DataTypes.DECIMAL(12, 2),\n      allowNull: false,\n      validate: {\n        min: 0.01,\n        max: 999999.99\n      }\n    },\n    description: {\n      type: DataTypes.STRING(500),\n      validate: {\n        len: [0, 500]\n      }\n    },\n    transactionDate: {\n      type: DataTypes.DATEONLY,\n      allowNull: false,\n      validate: {\n        isDate: true,\n        isNotFuture(value) {\n          if (value > new Date().toISOString().split('T')[0]) {\n            throw new Error('Transaction date cannot be in the future');\n          }\n        }\n      }\n    },\n    receiptImageUrl: {\n      type: DataTypes.STRING(500),\n      validate: {\n        isUrl: true\n      }\n    },\n    isOcrProcessed: {\n      type: DataTypes.BOOLEAN,\n      defaultValue: false\n    },\n    ocrConfidence: {\n      type: DataTypes.DECIMAL(3, 2),\n      validate: {\n        min: 0,\n        max: 1\n      }\n    },\n    tags: {\n      type: DataTypes.ARRAY(DataTypes.STRING),\n      defaultValue: []\n    },\n    isRecurring: {\n      type: DataTypes.BOOLEAN,\n      defaultValue: false\n    },\n    recurringPattern: {\n      type: DataTypes.ENUM('daily', 'weekly', 'monthly', 'yearly')\n    },\n    recurringEndDate: {\n      type: DataTypes.DATEONLY\n    },\n    splitTransactions: {\n      type: DataTypes.JSONB,\n      defaultValue: []\n    },\n    metadata: {\n      type: DataTypes.JSONB,\n      defaultValue: {}\n    }\n  }, {\n    indexes: [\n      {\n        fields: ['userId', 'transactionDate']\n      },\n      {\n        fields: ['userId', 'categoryId']\n      },\n      {\n        fields: ['userId', 'type']\n      },\n      {\n        fields: ['transactionDate']\n      }\n    ]\n  });\n\n  // Instance methods\n  Transaction.prototype.getFormattedAmount = function() {\n    return this.type === 'expense' \n      ? `-$${Math.abs(this.amount).toFixed(2)}`\n      : `$${this.amount.toFixed(2)}`;\n  };\n\n  // Class methods\n  Transaction.getMonthlySummary = async function(userId, year, month) {\n    const startDate = new Date(year, month - 1, 1);\n    const endDate = new Date(year, month, 0);\n\n    return this.findAll({\n      where: {\n        userId,\n        transactionDate: {\n          [Op.between]: [startDate, endDate]\n        }\n      },\n      attributes: [\n        'type',\n        [sequelize.fn('SUM', sequelize.col('amount')), 'total'],\n        [sequelize.fn('COUNT', sequelize.col('id')), 'count']\n      ],\n      group: ['type']\n    });\n  };\n\n  return Transaction;\n};"
    },
    {
        "index": 36,
        "content": "// backend/src/routes/transactions.js\nconst express = require('express');\nconst { body, param, query, validationResult } = require('express-validator');\nconst { Transaction, Category } = require('../models');\nconst { authenticate } = require('../middleware/auth');\nconst { logger } = require('../config/server');\nconst { Op } = require('sequelize');\n\nconst router = express.Router();\n\n// Validation middleware\nconst validate = (req, res, next) => {\n  const errors = validationResult(req);\n  if (!errors.isEmpty()) {\n    return res.status(400).json({ \n      success: false, \n      errors: errors.array() \n    });\n  }\n  next();\n};\n\n// Get transactions with pagination and filtering\nrouter.get('/',\n  authenticate,\n  [\n    query('page').optional().isInt({ min: 1 }),\n    query('limit').optional().isInt({ min: 1, max: 100 }),\n    query('startDate').optional().isISO8601(),\n    query('endDate').optional().isISO8601(),\n    query('categoryId').optional().isInt(),\n    query('type').optional().isIn(['income', 'expense']),\n    query('minAmount').optional().isFloat({ min: 0 }),\n    query('maxAmount').optional().isFloat({ min: 0 })\n  ],\n  validate,\n  async (req, res, next) => {\n    try {\n      const page = parseInt(req.query.page) || 1;\n      const limit = parseInt(req.query.limit) || 20;\n      const offset = (page - 1) * limit;\n\n      const whereClause = { userId: req.user.id };\n\n      // Apply filters\n      if (req.query.startDate && req.query.endDate) {\n        whereClause.transactionDate = {\n          [Op.between]: [req.query.startDate, req.query.endDate]\n        };\n      }\n\n      if (req.query.categoryId) {\n        whereClause.categoryId = req.query.categoryId;\n      }\n\n      if (req.query.type) {\n        whereClause.type = req.query.type;\n      }\n\n      if (req.query.minAmount || req.query.maxAmount) {\n        whereClause.amount = {};\n        if (req.query.minAmount) {\n          whereClause.amount[Op.gte] = req.query.minAmount;\n        }\n        if (req.query.maxAmount) {\n          whereClause.amount[Op.lte] = req.query.maxAmount;\n        }\n      }\n\n      const { count, rows: transactions } = await Transaction.findAndCountAll({\n        where: whereClause,\n        include: [{ model: Category, attributes: ['id', 'name', 'emoji'] }],\n        order: [['transactionDate', 'DESC'], ['createdAt', 'DESC']],\n        limit,\n        offset\n      });\n\n      // Calculate summary statistics\n      const summary = await Transaction.findAll({\n        where: whereClause,\n        attributes: [\n          'type',\n          [sequelize.fn('SUM', sequelize.col('amount')), 'total'],\n          [sequelize.fn('AVG', sequelize.col('amount')), 'average'],\n          [sequelize.fn('COUNT', sequelize.col('id')), 'count']\n        ],\n        group: ['type'],\n        raw: true\n      });\n\n      res.json({\n        success: true,\n        data: {\n          transactions,\n          pagination: {\n            page,\n            limit,\n            total: count,\n            pages: Math.ceil(count / limit)\n          },\n          summary: summary.reduce((acc, stat) => {\n            acc[stat.type] = {\n              total: parseFloat(stat.total),\n              average: parseFloat(stat.average),\n              count: parseInt(stat.count)\n            };\n            return acc;\n          }, {})\n        }\n      });\n\n      // Log successful request\n      logger.info('Transactions retrieved', {\n        userId: req.user.id,\n        page,\n        limit,\n        filters: req.query\n      });\n\n    } catch (error) {\n      logger.error('Error retrieving transactions', {\n        userId: req.user.id,\n        error: error.message,\n        stack: error.stack\n      });\n      next(error);\n    }\n  }\n);\n\n// Create new transaction\nrouter.post('/',\n  authenticate,\n  [\n    body('categoryId').isInt({ min: 1 }),\n    body('type').isIn(['income', 'expense']),\n    body('amount').isFloat({ min: 0.01, max: 999999.99 }),\n    body('description').optional().isLength({ max: 500 }),\n    body('transactionDate').isISO8601(),\n    body('receiptImageUrl').optional().isURL(),\n    body('tags').optional().isArray(),\n    body('isRecurring').optional().isBoolean(),\n    body('recurringPattern').optional().isIn(['daily', 'weekly', 'monthly', 'yearly']),\n    body('recurringEndDate').optional().isISO8601()\n  ],\n  validate,\n  async (req, res, next) => {\n    const t = await sequelize.transaction();\n    \n    try {\n      const {\n        categoryId,\n        type,\n        amount,\n        description,\n        transactionDate,\n        receiptImageUrl,\n        tags,\n        isRecurring,\n        recurringPattern,\n        recurringEndDate,\n        splitTransactions\n      } = req.body;\n\n      // Verify category belongs to user\n      const category = await Category.findOne({\n        where: { id: categoryId, userId: req.user.id }\n      });\n\n      if (!category) {\n        await t.rollback();\n        return res.status(400).json({\n          success: false,\n          error: 'Invalid category'\n        });\n      }\n\n      // Create transaction\n      const transaction = await Transaction.create({\n        userId: req.user.id,\n        categoryId,\n        type,\n        amount,\n        description,\n        transactionDate,\n        receiptImageUrl,\n        tags,\n        isRecurring,\n        recurringPattern,\n        recurringEndDate,\n        splitTransactions\n      }, { transaction: t });\n\n      // Handle recurring transactions\n      if (isRecurring && recurringPattern && recurringEndDate) {\n        await createRecurringTransactions(transaction, t);\n      }\n\n      await t.commit();\n\n      // Emit real-time update\n      req.io.to(`user_${req.user.id}`).emit('transaction:created', transaction);\n\n      res.status(201).json({\n        success: true,\n        data: transaction\n      });\n\n      // Trigger AI analysis\n      analyzeSpendingPatterns(req.user.id).catch(error => {\n        logger.error('AI analysis failed', { error: error.message });\n      });\n\n    } catch (error) {\n      await t.rollback();\n      logger.error('Error creating transaction', {\n        userId: req.user.id,\n        error: error.message,\n        stack: error.stack\n      });\n      next(error);\n    }\n  }\n);\n\nmodule.exports = router;"
    },
    {
        "index": 37,
        "content": "// frontend/next.config.js\nconst withPWA = require('next-pwa')({\n  dest: 'public',\n  register: true,\n  skipWaiting: true,\n  disable: process.env.NODE_ENV === 'development'\n});\n\nconst securityHeaders = [\n  {\n    key: 'X-DNS-Prefetch-Control',\n    value: 'on'\n  },\n  {\n    key: 'Strict-Transport-Security',\n    value: 'max-age=63072000; includeSubDomains; preload'\n  },\n  {\n    key: 'X-XSS-Protection',\n    value: '1; mode=block'\n  },\n  {\n    key: 'X-Frame-Options',\n    value: 'SAMEORIGIN'\n  },\n  {\n    key: 'X-Content-Type-Options',\n    value: 'nosniff'\n  },\n  {\n    key: 'Referrer-Policy',\n    value: 'origin-when-cross-origin'\n  },\n  {\n    key: 'Content-Security-Policy',\n    value: \"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' fonts.googleapis.com; font-src 'self' fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' api.example.com\"\n  }\n];\n\nmodule.exports = withPWA({\n  reactStrictMode: true,\n  swcMinify: true,\n  poweredByHeader: false,\n  compress: true,\n  images: {\n    domains: ['localhost', process.env.NEXT_PUBLIC_API_URL],\n    formats: ['image/avif', 'image/webp'],\n    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],\n    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],\n  },\n  async headers() {\n    return [\n      {\n        source: '/:path*',\n        headers: securityHeaders,\n      },\n    ];\n  },\n  async rewrites() {\n    return [\n      {\n        source: '/api/:path*',\n        destination: `${process.env.NEXT_PUBLIC_API_URL}/api/:path*`,\n      },\n    ];\n  },\n  env: {\n    NEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL,\n    NEXT_PUBLIC_STRIPE_PUBLIC_KEY: process.env.NEXT_PUBLIC_STRIPE_PUBLIC_KEY,\n    NEXT_PUBLIC_GOOGLE_ANALYTICS_ID: process.env.NEXT_PUBLIC_GOOGLE_ANALYTICS_ID,\n  },\n  i18n: {\n    locales: ['en', 'es', 'fr', 'de', 'it', 'pt', 'zh', 'ja', 'ko'],\n    defaultLocale: 'en',\n  },\n});"
    },
    {
        "index": 38,
        "content": "// frontend/components/Dashboard/Dashboard.jsx\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport dynamic from 'next/dynamic';\nimport { formatCurrency } from '@/utils/currency';\nimport { useAuth } from '@/hooks/useAuth';\nimport { transactionAPI } from '@/services/api';\nimport { ErrorBoundary } from '@/components/ErrorBoundary';\nimport { LoadingSpinner } from '@/components/UI/LoadingSpinner';\nimport { ErrorMessage } from '@/components/UI/ErrorMessage';\nimport { AIInsightsPanel } from './AIInsightsPanel';\nimport { DashboardFilters } from './DashboardFilters';\nimport { SummaryCards } from './SummaryCards';\nimport { TransactionList } from './TransactionList';\nimport { BudgetOverview } from './BudgetOverview';\nimport { InvestmentSummary } from './InvestmentSummary';\nimport styles from './Dashboard.module.css';\n\n// Lazy load charts for better performance\nconst ExpenseChart = dynamic(() => import('./ExpenseChart'), {\n  loading: () => <LoadingSpinner />,\n  ssr: false\n});\n\nconst IncomeExpenseTrend = dynamic(() => import('./IncomeExpenseTrend'), {\n  loading: () => <LoadingSpinner />,\n  ssr: false\n});\n\nconst BudgetChart = dynamic(() => import('./BudgetChart'), {\n  loading: () => <LoadingSpinner />,\n  ssr: false\n});\n\nexport const Dashboard = () => {\n  const { user } = useAuth();\n  const queryClient = useQueryClient();\n  const [filters, setFilters] = useState({\n    startDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),\n    endDate: new Date(),\n    categories: [],\n    types: []\n  });\n\n  // Fetch dashboard data with React Query\n  const { data: dashboardData, isLoading, error, refetch } = useQuery({\n    queryKey: ['dashboard', filters, user?.id],\n    queryFn: () => transactionAPI.getDashboard(filters),\n    enabled: !!user?.id,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n    cacheTime: 10 * 60 * 1000, // 10 minutes\n    retry: 3,\n    retryDelay: attemptIndex => Math.min(1000 * 2 ** attemptIndex, 30000)\n  });\n\n  // Real-time updates with WebSocket\n  useEffect(() => {\n    if (!user?.id) return;\n\n    const socket = io(process.env.NEXT_PUBLIC_API_URL, {\n      auth: { token: localStorage.getItem('token') }\n    });\n\n    socket.on(`user_${user.id}:transaction:created`, (data) => {\n      queryClient.invalidateQueries(['dashboard']);\n      queryClient.invalidateQueries(['transactions']);\n    });\n\n    socket.on(`user_${user.id}:transaction:updated`, (data) => {\n      queryClient.invalidateQueries(['dashboard']);\n      queryClient.invalidateQueries(['transactions']);\n    });\n\n    socket.on(`user_${user.id}:transaction:deleted`, (data) => {\n      queryClient.invalidateQueries(['dashboard']);\n      queryClient.invalidateQueries(['transactions']);\n    });\n\n    return () => socket.disconnect();\n  }, [user?.id, queryClient]);\n\n  // Error boundary fallback\n  if (error) {\n    return (\n      <ErrorMessage\n        title=\"Failed to load dashboard\"\n        message={error.message}\n        onRetry={refetch}\n      />\n    );\n  }\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div className={styles.loadingContainer}>\n        <LoadingSpinner size=\"large\" />\n        <p>Loading your financial dashboard...</p>\n      </div>\n    );\n  }\n\n  const { summary, recentTransactions, aiInsights, budgetStatus } = dashboardData?.data || {};\n\n  return (\n    <ErrorBoundary>\n      <div className={styles.dashboard}>\n        <div className={styles.header}>\n          <h1>Financial Dashboard</h1>\n          <DashboardFilters filters={filters} onFiltersChange={setFilters} />\n        </div>\n\n        <div className={styles.content}>\n          {/* Summary Cards */}\n          <SummaryCards summary={summary} />\n\n          {/* AI Insights */}\n          <AIInsightsPanel insights={aiInsights} />\n\n          {/* Charts Grid */}\n          <div className={styles.chartsGrid}>\n            <div className={styles.chartContainer}>\n              <h3>Income vs Expenses Trend</h3>\n              <IncomeExpenseTrend data={summary?.trendData} />\n            </div>\n            <div className={styles.chartContainer}>\n              <h3>Spending by Category</h3>\n              <ExpenseChart data={summary?.categoryBreakdown} />\n            </div>\n          </div>\n\n          {/* Budget Overview */}\n          <BudgetOverview budgetStatus={budgetStatus} />\n\n          {/* Recent Transactions */}\n          <div className={styles.section}>\n            <div className={styles.sectionHeader}>\n              <h3>Recent Transactions</h3>\n              <Link href=\"/transactions\" className={styles.viewAllLink}>\n                View All ‚Üí\n              </Link>\n            </div>\n            <TransactionList transactions={recentTransactions} />\n          </div>\n\n          {/* Investment Summary */}\n          <InvestmentSummary investments={summary?.investments} />\n        </div>\n      </div>\n    </ErrorBoundary>\n  );\n};"
    },
    {
        "index": 39,
        "content": "// frontend/services/api.js\nimport axios from 'axios';\nimport { getToken, removeToken } from '@/utils/auth';\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL;\n\n// Create axios instance with default config\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 30000,\n  headers: {\n    'Content-Type': 'application/json',\n  }\n});\n\n// Request interceptor for auth\napi.interceptors.request.use(\n  (config) => {\n    const token = getToken();\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Response interceptor for error handling\napi.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n\n    if (error.response?.status === 401 && !originalRequest._retry) {\n      originalRequest._retry = true;\n      \n      try {\n        // Try to refresh token\n        const refreshToken = localStorage.getItem('refreshToken');\n        if (refreshToken) {\n          const response = await axios.post(`${API_BASE_URL}/auth/refresh`, {\n            refreshToken\n          });\n          \n          const { token } = response.data;\n          localStorage.setItem('token', token);\n          api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n          \n          return api(originalRequest);\n        }\n      } catch (refreshError) {\n        // Refresh failed, redirect to login\n        removeToken();\n        window.location.href = '/login';\n        return Promise.reject(refreshError);\n      }\n    }\n\n    return Promise.reject(error);\n  }\n);\n\nexport const transactionAPI = {\n  // Get transactions with filters\n  getTransactions: async (filters = {}) => {\n    const response = await api.get('/transactions', { params: filters });\n    return response.data;\n  },\n\n  // Create new transaction\n  createTransaction: async (transaction) => {\n    const response = await api.post('/transactions', transaction);\n    return response.data;\n  },\n\n  // Update transaction\n  updateTransaction: async (id, updates) => {\n    const response = await api.put(`/transactions/${id}`, updates);\n    return response.data;\n  },\n\n  // Delete transaction\n  deleteTransaction: async (id) => {\n    const response = await api.delete(`/transactions/${id}`);\n    return response.data;\n  },\n\n  // Get dashboard data\n  getDashboard: async (filters) => {\n    const response = await api.get('/dashboard', { params: filters });\n    return response.data;\n  },\n\n  // Upload receipt for OCR\n  uploadReceipt: async (file) => {\n    const formData = new FormData();\n    formData.append('image', file);\n    \n    const response = await api.post('/ocr/extract', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data',\n      },\n    });\n    return response.data;\n  },\n\n  // Voice input processing\n  processVoiceInput: async (audioBlob) => {\n    const formData = new FormData();\n    formData.append('audio', audioBlob);\n    \n    const response = await api.post('/voice/process', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data',\n      },\n    });\n    return response.data;\n  }\n};\n\nexport const budgetAPI = {\n  getBudgets: async () => {\n    const response = await api.get('/budgets');\n    return response.data;\n  },\n\n  createBudget: async (budget) => {\n    const response = await api.post('/budgets', budget);\n    return response.data;\n  },\n\n  updateBudget: async (id, updates) => {\n    const response = await api.put(`/budgets/${id}`, updates);\n    return response.data;\n  },\n\n  deleteBudget: async (id) => {\n    const response = await api.delete(`/budgets/${id}`);\n    return response.data;\n  }\n};\n\nexport const investmentAPI = {\n  getInvestments: async () => {\n    const response = await api.get('/investments');\n    return response.data;\n  },\n\n  createInvestment: async (investment) => {\n    const response = await api.post('/investments', investment);\n    return response.data;\n  },\n\n  updateInvestment: async (id, updates) => {\n    const response = await api.put(`/investments/${id}`, updates);\n    return response.data;\n  },\n\n  deleteInvestment: async (id) => {\n    const response = await api.delete(`/investments/${id}`);\n    return response.data;\n  }\n};\n\nexport const aiAPI = {\n  getInsights: async () => {\n    const response = await api.get('/ai/insights');\n    return response.data;\n  },\n\n  getRecommendations: async () => {\n    const response = await api.get('/ai/recommendations');\n    return response.data;\n  }\n};\n\nexport default api;"\n
    }\n
]